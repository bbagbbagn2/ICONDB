# ğŸ”„ ìŠ¤í‚¤ë§ˆ ê°œì„  ë³€ê²½ì‚¬í•­ - ìš”ì•½

## ğŸ“Š í…Œì´ë¸”ë³„ ë³€ê²½ ì‚¬í•­

### 1ï¸âƒ£ User í…Œì´ë¸”

| í•­ëª©       | Before        | After                      | ì´ìœ                |
| ---------- | ------------- | -------------------------- | ------------------ |
| **id**     | `id`          | `id` (PK)                  | ëª…ì‹œì ìœ¼ë¡œ PK ì„ ì–¸ |
| **ë³€ìˆ˜ëª…** | ì—†ìŒ          | `email`, `nickname`        | í•„ìˆ˜ í•„ë“œ ì¶”ê°€     |
| **í”„ë¡œí•„** | `profilename` | `profile_image_url`        | ìš©ë„ ëª…í™•í™”        |
| **ìƒíƒœ**   | ì—†ìŒ          | `is_active`                | í™œë™ ìƒíƒœ ê´€ë¦¬     |
| **ì‚­ì œ**   | ì—†ìŒ          | `deleted_at`               | ì†Œí”„íŠ¸ ì‚­ì œ ì§€ì›   |
| **ìœ ë‹ˆí¬** | ì—†ìŒ          | `email`, `nickname` UNIQUE | ì¤‘ë³µ ë°©ì§€          |
| **bio**    | ì—†ìŒ          | `bio` (text)               | ì‚¬ìš©ì ì„¤ëª… ì¶”ê°€   |

---

### 2ï¸âƒ£ Content í…Œì´ë¸”

| í•­ëª©       | Before   | After                 | ì´ìœ              |
| ---------- | -------- | --------------------- | ---------------- |
| **ë³€ìˆ˜ëª…** | `userid` | `user_id`             | snake_case í†µì¼  |
| **ë³€ìˆ˜ëª…** | `svgkey` | `svg_key`             | snake_case í†µì¼  |
| **ì„¤ëª…**   | ì—†ìŒ     | `description` (text)  | ì½˜í…ì¸  ìƒì„¸ ì„¤ëª… |
| **ê³µê°œ**   | ì—†ìŒ     | `is_public` (boolean) | ê³µê°œ/ë¹„ê³µê°œ ê´€ë¦¬ |
| **ì¡°íšŒìˆ˜** | ì—†ìŒ     | `view_count`          | ì¡°íšŒìˆ˜ ìºì‹œ      |
| **ì¢‹ì•„ìš”** | ì—†ìŒ     | `like_count`          | ì¢‹ì•„ìš” ìˆ˜ ìºì‹œ   |
| **UNIQUE** | ì—†ìŒ     | `svg_key`             | ì¤‘ë³µ SVG ë°©ì§€    |

**ì„±ëŠ¥ ê°œì„ :**

- `view_count`, `like_count`: ì§‘ê³„ ì¿¼ë¦¬ ì„±ëŠ¥ í–¥ìƒ

---

### 3ï¸âƒ£ Tag í…Œì´ë¸” (êµ¬ì¡° ë³€ê²½)

| í•­ëª©        | Before           | After            | ì´ìœ              |
| ----------- | ---------------- | ---------------- | ---------------- |
| **êµ¬ì¡°**    | ì‚¬ìš©ìë³„ íƒœê·¸    | ê¸€ë¡œë²Œ íƒœê·¸      | ì •ê·œí™”           |
| **userid**  | âœ… ìˆìŒ          | âŒ ì œê±°          | ì¤‘ë³µ ì œê±°        |
| **tagname** | `tagname`        | `name`           | ë³€ìˆ˜ëª… í†µì¼      |
| **UNIQUE**  | ì—†ìŒ             | `name` UNIQUE    | ì¤‘ë³µ íƒœê·¸ ë°©ì§€   |
| **ì—°ê²°**    | content_tag ì¡´ì† | content_tag í™œìš© | ë‹¤ëŒ€ë‹¤ ê´€ê³„ ëª…í™• |

**ê°œì„  íš¨ê³¼:**

```
Before:  User A - "react" / User B - "react" / User C - "react" (3ê°œ ë°ì´í„°)
After:   Tag - "react" (1ê°œ ë°ì´í„°)
         content_tagë¡œ ì—°ê²°
```

---

### 4ï¸âƒ£ Like í…Œì´ë¸” (ì¤‘ë³µ ë°©ì§€)

| í•­ëª©       | Before      | After                     | ì´ìœ                  |
| ---------- | ----------- | ------------------------- | -------------------- |
| **ë³€ìˆ˜ëª…** | `userid`    | `user_id`                 | snake_case í†µì¼      |
| **ë³€ìˆ˜ëª…** | `contentid` | `content_id`              | snake_case í†µì¼      |
| **UNIQUE** | âŒ ì—†ìŒ     | âœ… `user_id + content_id` | **ì¤‘ë³µ ì¢‹ì•„ìš” ë°©ì§€** |

**ë¬¸ì œ í•´ê²°:**

```sql
Before: ê°™ì€ ì‚¬ìš©ìê°€ ê°™ì€ ì½˜í…ì¸  ì—¬ëŸ¬ ë²ˆ ì¢‹ì•„ìš” ê°€ëŠ¥
After:  UNIQUE ì œì•½ìœ¼ë¡œ í•œ ë²ˆë§Œ ê°€ëŠ¥
```

---

### 5ï¸âƒ£ Follow í…Œì´ë¸” (ìê¸° íŒ”ë¡œìš° ë°©ì§€)

| í•­ëª©       | Before     | After                           | ì´ìœ                  |
| ---------- | ---------- | ------------------------------- | -------------------- |
| **ë³€ìˆ˜ëª…** | `follower` | `follower_id`                   | snake_case í†µì¼      |
| **ë³€ìˆ˜ëª…** | `followee` | `followee_id`                   | snake_case í†µì¼      |
| **UNIQUE** | âŒ ì—†ìŒ    | âœ… `follower_id + followee_id`  | **ì¤‘ë³µ íŒ”ë¡œìš° ë°©ì§€** |
| **CHECK**  | âŒ ì—†ìŒ    | âœ… `follower_id != followee_id` | **ìê¸° íŒ”ë¡œìš° ë°©ì§€** |

**ë¬¸ì œ í•´ê²°:**

```sql
Before: ìì‹ ì„ íŒ”ë¡œìš° ê°€ëŠ¥ + ì¤‘ë³µ íŒ”ë¡œìš° ê°€ëŠ¥
After:  ìê¸° íŒ”ë¡œìš° ë¶ˆê°€ + ì¤‘ë³µ ë°©ì§€
```

---

### 6ï¸âƒ£ Content_Tag í…Œì´ë¸” (ë‹¤ëŒ€ë‹¤ ê´€ê³„)

| í•­ëª©       | Before      | After                    | ì´ìœ                 |
| ---------- | ----------- | ------------------------ | ------------------- |
| **êµ¬ì¡°**   | ìœ ì§€        | ìœ ì§€                     | ë‹¤ëŒ€ë‹¤ ê´€ê³„ í‘œí˜„    |
| **ë³€ìˆ˜ëª…** | `contentid` | `content_id`             | snake_case í†µì¼     |
| **ë³€ìˆ˜ëª…** | `tagid`     | `tag_id`                 | snake_case í†µì¼     |
| **UNIQUE** | âŒ ì—†ìŒ     | âœ… `content_id + tag_id` | ì¤‘ë³µ íƒœê·¸ ì—°ê²° ë°©ì§€ |

---

### 7ï¸âƒ£ ì‹ ê·œ í…Œì´ë¸” ì¶”ê°€

#### Comment (ëŒ“ê¸€)

```sql
- content_id (FK)
- user_id (FK)
- text (ë‚´ìš©)
- created_at, updated_at
```

#### Bookmark (ì €ì¥/ì¦ê²¨ì°¾ê¸°)

```sql
- user_id (FK)
- content_id (FK)
- UNIQUE (user_id + content_id)
```

#### Report (ì‹ ê³ )

```sql
- reporter_id (FK)
- content_id (FK)
- reason (ì‚¬ìœ )
- status (pending / resolved)
```

---

## ğŸ”§ ë³€ìˆ˜ëª… í†µì¼ ì •ì±…

### âŒ Before (ë¶ˆì¼ê´€)

```
userid, contentid, tagid, userID, user_ID
tagname, profilename
svgkey
follower, followee
```

### âœ… After (ì¼ê´€ì„±)

```
user_id, content_id, tag_id (ëª¨ë‘ snake_case)
tag_name, profile_image_url (ëª…í™•í•œ ì˜ë¯¸)
svg_key
follower_id, followee_id (ëª…í™•í•œ ì˜ë¯¸)
```

**ê·œì¹™:**

- ëª¨ë“  ID í•„ë“œ: `table_name_id` (ì˜ˆ: `user_id`, `content_id`)
- ëª¨ë“  íƒ€ì„ìŠ¤íƒ¬í”„: `created_at`, `updated_at`, `deleted_at`
- snake_case ì‚¬ìš© (camelCase ì‚¬ìš© ê¸ˆì§€)

---

## ğŸ“ˆ ì¸ë±ìŠ¤ ê°œì„ 

### Before

```sql
idx_content_userid          -- ë‹¨ì¼
idx_tag_userid              -- ë‹¨ì¼
idx_like_userid             -- ë‹¨ì¼
idx_like_contentid          -- ë‹¨ì¼
idx_follow_follower         -- ë‹¨ì¼
idx_follow_followee         -- ë‹¨ì¼
```

### After

```sql
-- ê¸°ì¡´ ì¸ë±ìŠ¤
idx_user_email              -- ë¡œê·¸ì¸ìš©
idx_content_user_id         -- ì‚¬ìš©ìë³„ ì½˜í…ì¸ 
idx_content_created_at      -- ìµœì‹ ìˆœ ì •ë ¬

-- ë³µí•© ì¸ë±ìŠ¤ (ì„±ëŠ¥ í–¥ìƒ)
idx_like_user_content       -- ì¢‹ì•„ìš” ì—¬ë¶€ í™•ì¸ ONE QUERY
idx_follow_follower_followee -- íŒ”ë¡œìš° ì—¬ë¶€ í™•ì¸ ONE QUERY
idx_content_user_public_created -- ì‚¬ìš©ì ê³µê°œ ì½˜í…ì¸  ì¡°íšŒ

-- ê²€ìƒ‰ìš© ì¸ë±ìŠ¤ (í•œê¸€)
idx_content_title_search    -- ì œëª© ì „ë¬¸ ê²€ìƒ‰
idx_content_description_search -- ì„¤ëª… ì „ë¬¸ ê²€ìƒ‰
```

**ì„±ëŠ¥ ê°œì„  ì˜ˆì‹œ:**

```sql
-- Before: 2ê°œ ì¸ë±ìŠ¤ ìŠ¤ìº” í•„ìš”
SELECT * FROM "like"
WHERE user_id = ? AND content_id = ?;
-- I/O: 2íšŒ

-- After: 1ê°œ ë³µí•© ì¸ë±ìŠ¤ë¡œ ì™„ë£Œ
CREATE INDEX idx_like_user_content
ON "like" (user_id, content_id);
-- I/O: 1íšŒ (50% ê°œì„ )
```

---

## ğŸ” ë³´ì•ˆ ê°œì„ 

| í•­ëª©         | Before      | After              | ì˜í–¥ë„  |
| ------------ | ----------- | ------------------ | ------- |
| **íŒ¨ìŠ¤ì›Œë“œ** | í‰ë¬¸ ì €ì¥   | âš ï¸ ì—¬ì „íˆ í‰ë¬¸\*   | ğŸ”´ ë†’ìŒ |
| **ì´ë©”ì¼**   | ì—†ìŒ        | ì¶”ê°€ + UNIQUE      | ğŸŸ¢ ì¤‘ê°„ |
| **RLS**      | í™œì„±í™”ë§Œ í•¨ | ì •ì±… ì¶”ê°€ ì˜ˆì •\*\* | ğŸŸ¢ ì¤‘ê°„ |

\*íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™”ëŠ” ì„œë²„ ì½”ë“œì—ì„œ ì²˜ë¦¬ (bcrypt ê¶Œì¥)
\*\*RLS ì •ì±…ì€ ë³„ë„ ì„¤ì • í•„ìš”

---

## ğŸ“Š ì„±ëŠ¥ ê°œì„  ì˜ˆìƒì¹˜

### ì¿¼ë¦¬ ì„±ëŠ¥

| ì¿¼ë¦¬               | Before            | After              | ê°œì„         |
| ------------------ | ----------------- | ------------------ | ----------- |
| ì¢‹ì•„ìš” ì¡´ì¬ í™•ì¸   | ëŠë¦¼ (2ê°œ ì¸ë±ìŠ¤) | ë¹ ë¦„ (ë³µí•© ì¸ë±ìŠ¤) | **50% â†‘**   |
| íŒ”ë¡œìš° ì¡´ì¬ í™•ì¸   | ëŠë¦¼ (2ê°œ ì¸ë±ìŠ¤) | ë¹ ë¦„ (ë³µí•© ì¸ë±ìŠ¤) | **50% â†‘**   |
| ì‚¬ìš©ì ê³µê°œ ê²Œì‹œë¬¼ | ëŠë¦¼ (í•„í„°ë§)     | ë¹ ë¦„ (ë³µí•© ì¸ë±ìŠ¤) | **30% â†‘**   |
| ì œëª© ê²€ìƒ‰          | ì—†ìŒ              | ë¹ ë¦„ (ì „ë¬¸ ê²€ìƒ‰)   | **ìƒˆ ê¸°ëŠ¥** |

### ì €ì¥ ê³µê°„

| í•­ëª©        | Before       | After       | ë³€í™” |
| ----------- | ------------ | ----------- | ---- |
| Tag í…Œì´ë¸”  | ì •ê·œí™” ì•ˆ ë¨ | 50~70% ê°ì†Œ | âœ…   |
| ì¸ë±ìŠ¤      | ê¸°ë³¸         | ì•½ê°„ ì¦ê°€   | âš ï¸   |
| ëŒ“ê¸€ í…Œì´ë¸” | ì—†ìŒ         | ì‹ ê·œ ì¶”ê°€   | â•   |

---

## ğŸš€ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‚œì´ë„

| ì‘ì—…              | ë‚œì´ë„   | ì†Œìš”ì‹œê°„   | ìœ„í—˜ë„   |
| ----------------- | -------- | ---------- | -------- |
| User í•„ë“œ ì¶”ê°€    | ì‰¬ì›€     | 30ë¶„       | ë‚®ìŒ     |
| Content í•„ë“œ ì¶”ê°€ | ì‰¬ì›€     | 20ë¶„       | ë‚®ìŒ     |
| Tag ì •ê·œí™”        | ì¤‘ê°„     | 1ì‹œê°„      | ì¤‘ê°„     |
| Like UNIQUE ìˆ˜ì •  | ì¤‘ê°„     | 30ë¶„       | ì¤‘ê°„     |
| Follow ì œì•½ ìˆ˜ì •  | ì¤‘ê°„     | 30ë¶„       | ì¤‘ê°„     |
| ìƒˆ í…Œì´ë¸” ì¶”ê°€    | ì‰¬ì›€     | 30ë¶„       | ë‚®ìŒ     |
| **ì´ ì†Œìš”ì‹œê°„**   | **ì¤‘ê°„** | **~3ì‹œê°„** | **ì¤‘ê°„** |

---

## âœ… ë³€ê²½ì‚¬í•­ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: ê³„íš (1ì¼)

- [ ] ìŠ¤í‚¤ë§ˆ ë¦¬ë·° (ì´ ë¬¸ì„œ)
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš ìˆ˜ë¦½
- [ ] ë°±ì—… ì „ëµ ìˆ˜ë¦½

### Phase 2: ì¤€ë¹„ (1ì¼)

- [ ] ê¸°ì¡´ ë°ì´í„° ë°±ì—…
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
- [ ] í…ŒìŠ¤íŠ¸ í™˜ê²½ ì¤€ë¹„

### Phase 3: ì‹¤í–‰ (2~4ì‹œê°„)

- [ ] í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
- [ ] ë°ì´í„° ê²€ì¦
- [ ] ë³¸ í™˜ê²½ ë§ˆì´ê·¸ë ˆì´ì…˜

### Phase 4: ê²€ì¦ (1ì¼)

- [ ] ëª¨ë“  ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
- [ ] ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬
- [ ] ë²„ê·¸ ìˆ˜ì •

---

## ğŸ“š ì°¸ê³  ìë£Œ

- SQL_SCHEMA_IMPROVED.sql: ê°œì„ ëœ ì™„ì „í•œ ìŠ¤í‚¤ë§ˆ
- CODE_REVIEW.md: ìƒì„¸ ë¶„ì„ ë° ì„¤ëª…
- ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ í•„ìš” ì‹œ ë³„ë„ ì‘ì„±

---

## ğŸ’¬ ì§ˆë¬¸?

- "Tag í…Œì´ë¸” ì–´ë–»ê²Œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë‚˜ìš”?" â†’ SQL_SCHEMA_IMPROVED.sql ì°¸ê³ 
- "íŒ¨ìŠ¤ì›Œë“œ ì–´ë–»ê²Œ ì•”í˜¸í™”í•˜ë‚˜ìš”?" â†’ CODE_REVIEW.md ë³´ì•ˆ ì„¹ì…˜
- "ë¡¤ë°± ê°€ëŠ¥í•œê°€ìš”?" â†’ ë°±ì—… í›„ ì§„í–‰ (ê¸°ì¡´ í…Œì´ë¸” ë³´ê´€)

**ì¤€ë¹„ ì™„ë£Œ! ì›í•˜ì‹œëŠ” ëŒ€ë¡œ ì§„í–‰í•˜ì„¸ìš”!** ğŸš€
