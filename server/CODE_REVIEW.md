# ğŸ“‹ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì½”ë“œ ë¦¬ë·°

### ì•„ì´ì½˜ ê³µìœ  í”Œë«í¼ (ICONDB)

---

## ğŸŸ¡ ë°œê²¬ëœ ì´ìŠˆ ìš”ì•½

| ì‹¬ê°ë„      | ì´ìŠˆ                              | í•´ê²°í•„ìš” |
| ----------- | --------------------------------- | -------- |
| ğŸ”´ **ë†’ìŒ** | ë³€ìˆ˜ëª… ì¼ê´€ì„± ë¶€ì¡±                | âœ… í•„ìˆ˜  |
| ğŸ”´ **ë†’ìŒ** | Like/Follow í…Œì´ë¸” ì¤‘ë³µ ë°©ì§€ ë¯¸í¡ | âœ… í•„ìˆ˜  |
| ğŸŸ  **ì¤‘ê°„** | User í…Œì´ë¸” í•„ë“œ ë¶€ì¡±             | âœ… ê¶Œì¥  |
| ğŸŸ  **ì¤‘ê°„** | íŒ¨ìŠ¤ì›Œë“œ í‰ë¬¸ ì €ì¥ (ë³´ì•ˆ)         | âœ… ê¶Œì¥  |
| ğŸŸ  **ì¤‘ê°„** | Content ë©”íƒ€ë°ì´í„° ë¶€ì¡±           | âœ… ê¶Œì¥  |
| ğŸŸ¡ **ë‚®ìŒ** | Tag í…Œì´ë¸” ì„¤ê³„ ê°œì„  í•„ìš”         | ì„ íƒì‚¬í•­ |

---

## ğŸ”´ ìƒì„¸ ë¶„ì„

### 1ï¸âƒ£ ë³€ìˆ˜ëª… ì¼ê´€ì„± ë¬¸ì œ (ì‹¬ê°ë„: ë†’ìŒ)

#### âŒ ë¬¸ì œì 

```sql
-- ë³€ìˆ˜ëª…ì´ ì¼ê´€ì„±ì´ ì—†ìŒ
"userid"          -- snake_caseì²˜ëŸ¼ ë³´ì´ì§€ë§Œ camelCase?
"contentid"       -- ë™ì¼í•˜ê²Œ ë¶ˆì¼ê´€ì„±
"tagid"           -- ë™ì¼
"tagname"         -- ëª…í™•í•¨
"profilename"     -- íŒŒì¼ ê²½ë¡œì¸ë° nameì´ë¼ê³  í‘œí˜„ (í˜¼ë™ ê°€ëŠ¥)
"follower"        -- ëª…í™•í•¨
```

#### âœ… ê°œì„ ì•ˆ

```sql
-- ì¼ê´€ëœ snake_case ì‚¬ìš©
"user_id"         -- ëª…í™•í•˜ê³  ì¼ê´€ë¨
"content_id"
"tag_id"
"tag_name"        -- íƒœê·¸ ì´ë¦„ ëª…í™•
"profile_image_url" -- ë˜ëŠ” profile_image_key (ìš©ë„ ëª…í™•)
"follower_id"
"followee_id"
```

---

### 2ï¸âƒ£ Like í…Œì´ë¸” - ì¤‘ë³µ ë°©ì§€ ë¯¸í¡ (ì‹¬ê°ë„: ë†’ìŒ)

#### âŒ í˜„ì¬ ì½”ë“œ

```sql
CREATE TABLE "public"."like" (
    "id" bigint generated by default as identity,
    "userid" character varying(255) NOT NULL,
    "contentid" bigint NOT NULL,
    "created_at" timestamp with time zone DEFAULT (now() AT TIME ZONE 'utc'::text),
    constraint "like_pkey" primary key ("id"),
    -- âš ï¸ UNIQUE ì œì•½ì´ ì—†ìŒ!
);
```

#### ğŸ› ë°œìƒ ê°€ëŠ¥í•œ ë²„ê·¸

```
ê°™ì€ ì‚¬ìš©ìê°€ ê°™ì€ ì½˜í…ì¸ ë¥¼ ì—¬ëŸ¬ ë²ˆ ì¢‹ì•„ìš” ê°€ëŠ¥
â†’ ë°ì´í„° ë¬´ê²°ì„± ë¬¸ì œ, ì¢‹ì•„ìš” ìˆ˜ ê³„ì‚° ì˜¤ë¥˜
```

#### âœ… í•´ê²°ì±…

```sql
ALTER TABLE "public"."like"
ADD CONSTRAINT like_userid_contentid_unique
UNIQUE ("user_id", "content_id");
```

---

### 3ï¸âƒ£ Follow í…Œì´ë¸” - ìê¸° íŒ”ë¡œìš° ë°©ì§€ ì—†ìŒ (ì‹¬ê°ë„: ë†’ìŒ)

#### âŒ í˜„ì¬ ì½”ë“œ

```sql
CREATE TABLE "public"."follow" (
    "id" bigint generated by default as identity,
    "follower" character varying(255) NOT NULL,
    "followee" character varying(255) NOT NULL,
    -- âš ï¸ ìì‹ ì„ íŒ”ë¡œìš°í•˜ëŠ” ê²½ìš° ë°©ì§€ ë¶ˆê°€
    -- âš ï¸ ì¤‘ë³µ íŒ”ë¡œìš° ë°©ì§€ ì—†ìŒ
);
```

#### ğŸ› ë°œìƒ ê°€ëŠ¥í•œ ë²„ê·¸

```
1. ì‚¬ìš©ìê°€ ìì‹ ì„ íŒ”ë¡œìš° ê°€ëŠ¥
2. ê°™ì€ íŒ”ë¡œìš° ê´€ê³„ ì—¬ëŸ¬ ë²ˆ ìƒì„± ê°€ëŠ¥
3. íŒ”ë¡œìš° ìˆ˜ ê³„ì‚° ì˜¤ë¥˜
```

#### âœ… í•´ê²°ì±…

```sql
-- 1. UNIQUE ì œì•½ ì¶”ê°€
ALTER TABLE "public"."follow"
ADD CONSTRAINT follow_follower_followee_unique
UNIQUE ("follower_id", "followee_id");

-- 2. ìê¸° íŒ”ë¡œìš° ë°©ì§€ ì²´í¬
ALTER TABLE "public"."follow"
ADD CONSTRAINT follow_not_self_check
CHECK ("follower_id" != "followee_id");
```

---

### 4ï¸âƒ£ User í…Œì´ë¸” - í•„ë“œ ë¶€ì¡± (ì‹¬ê°ë„: ì¤‘ê°„)

#### âŒ í˜„ì¬ ì½”ë“œ

```sql
CREATE TABLE "public"."user" (
    "id" character varying(255) NOT NULL,
    "password" character varying(255) NOT NULL,
    "nickname" character varying(100),
    "profilename" character varying(255),
    "created_at" timestamp with time zone DEFAULT (now() AT TIME ZONE 'utc'::text),
    -- âŒ ë¶€ì¡±í•œ í•„ë“œë“¤:
    -- - email (í•„ìˆ˜)
    -- - bio/description (ì„ íƒ)
    -- - profile_image_url (ë¶„ëª…í•¨)
    -- - is_active (íƒˆí‡´ ê´€ë¦¬)
    -- - deleted_at (ì†Œí”„íŠ¸ ì‚­ì œ)
    -- - updated_at (í”„ë¡œí•„ ìˆ˜ì • ì¶”ì )
);
```

#### âœ… ê°œì„ ì•ˆ

```sql
CREATE TABLE "public"."user" (
    "id" character varying(255) PRIMARY KEY,
    "email" character varying(255) NOT NULL UNIQUE,
    "password" character varying(255) NOT NULL,
    "nickname" character varying(100) NOT NULL UNIQUE,
    "bio" text,                              -- ìê¸°ì†Œê°œ
    "profile_image_url" character varying(500),  -- í”„ë¡œí•„ ì´ë¯¸ì§€
    "is_active" boolean DEFAULT true,       -- í™œë™ ìƒíƒœ
    "created_at" timestamp DEFAULT now(),
    "updated_at" timestamp DEFAULT now(),
    "deleted_at" timestamp,                 -- ì†Œí”„íŠ¸ ì‚­ì œ
    constraint "user_email_unique" unique ("email"),
    constraint "user_nickname_unique" unique ("nickname")
);
```

---

### 5ï¸âƒ£ Content í…Œì´ë¸” - ë©”íƒ€ë°ì´í„° ë¶€ì¡± (ì‹¬ê°ë„: ì¤‘ê°„)

#### âŒ í˜„ì¬ ì½”ë“œ

```sql
CREATE TABLE "public"."content" (
    "id" bigint generated by default as identity,
    "userid" character varying(255) NOT NULL,
    "title" character varying(255),
    "svgkey" character varying(255) NOT NULL,
    "created_at" timestamp with time zone DEFAULT (now() AT TIME ZONE 'utc'::text),
    "updated_at" timestamp with time zone DEFAULT (now() AT TIME ZONE 'utc'::text),
    -- âŒ ë¶€ì¡±í•œ í•„ë“œë“¤:
    -- - description (ìƒì„¸ ì„¤ëª…)
    -- - view_count (ì¡°íšŒ ìˆ˜)
    -- - like_count (ì¢‹ì•„ìš” ìˆ˜ - ìºì‹œ)
    -- - is_public (ê³µê°œ/ë¹„ê³µê°œ)
    -- - license/attribution (ì €ì‘ê¶Œ)
);
```

#### âœ… ê°œì„ ì•ˆ

```sql
CREATE TABLE "public"."content" (
    "id" bigint generated by default as identity PRIMARY KEY,
    "user_id" character varying(255) NOT NULL,
    "title" character varying(255) NOT NULL,
    "description" text,                    -- ìƒì„¸ ì„¤ëª…
    "svg_key" character varying(255) NOT NULL UNIQUE,
    "view_count" bigint DEFAULT 0,        -- ì¡°íšŒ ìˆ˜ (ìºì‹œìš©)
    "like_count" bigint DEFAULT 0,        -- ì¢‹ì•„ìš” ìˆ˜ (ìºì‹œìš©)
    "is_public" boolean DEFAULT true,    -- ê³µê°œ ì—¬ë¶€
    "created_at" timestamp DEFAULT now(),
    "updated_at" timestamp DEFAULT now(),
    constraint "content_user_id_fkey"
        foreign key ("user_id") references "user"("id") on delete cascade
);
```

---

### 6ï¸âƒ£ Tag í…Œì´ë¸” - ì„¤ê³„ ê°œì„  í•„ìš” (ì‹¬ê°ë„: ì¤‘ê°„)

#### âŒ í˜„ì¬ ë¬¸ì œ

```sql
CREATE TABLE "public"."tag" (
    "id" bigint generated by default as identity,
    "userid" character varying(255) NOT NULL,  -- âš ï¸ ë¬¸ì œ!
    "tagname" character varying(100) NOT NULL,
);
```

**ë¬¸ì œì :**

- ê° ì‚¬ìš©ìë§ˆë‹¤ "react" íƒœê·¸ê°€ ì—¬ëŸ¬ ê°œ ìƒì„±ë¨
- ì „ì—­ íƒœê·¸ê°€ ì•„ë‹Œ ì‚¬ìš©ìë³„ íƒœê·¸
- íƒœê·¸ ì •ê·œí™” ë¶€ì¡±

#### âœ… ê°œì„ ì•ˆ (2ê°€ì§€ ë°©ì‹)

**ë°©ì‹ 1: ê¸€ë¡œë²Œ íƒœê·¸** (ê¶Œì¥)

```sql
CREATE TABLE "public"."tag" (
    "id" bigint generated by default as identity PRIMARY KEY,
    "name" character varying(100) NOT NULL UNIQUE,
    "description" text,
    "created_at" timestamp DEFAULT now(),
    "updated_by" character varying(255)  -- ëˆ„ê°€ ìƒì„±í–ˆëŠ”ì§€ (ì„ íƒ)
);

-- content_tag ì—°ê²° í…Œì´ë¸”ì€ ìœ ì§€
CREATE TABLE "public"."content_tag" (
    "id" bigint generated by default as identity PRIMARY KEY,
    "content_id" bigint NOT NULL,
    "tag_id" bigint NOT NULL,
    "created_at" timestamp DEFAULT now(),
    constraint "unique_content_tag" unique ("content_id", "tag_id"),
    foreign key ("content_id") references "content"("id") on delete cascade,
    foreign key ("tag_id") references "tag"("id") on delete cascade
);
```

**ë°©ì‹ 2: ì‚¬ìš©ìë³„ íƒœê·¸** (í˜„ì¬ êµ¬ì¡° ìœ ì§€ ì‹œ)

```sql
CREATE TABLE "public"."tag" (
    "id" bigint generated by default as identity PRIMARY KEY,
    "user_id" character varying(255) NOT NULL,
    "name" character varying(100) NOT NULL,
    "created_at" timestamp DEFAULT now(),
    constraint "unique_user_tag" unique ("user_id", "name"),
    foreign key ("user_id") references "user"("id") on delete cascade
);
```

---

### 7ï¸âƒ£ íŒ¨ìŠ¤ì›Œë“œ ë³´ì•ˆ (ì‹¬ê°ë„: ë†’ìŒ)

#### âŒ í˜„ì¬ ìƒíƒœ

```sql
"password" character varying(255) NOT NULL,
-- âš ï¸ í‰ë¬¸ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆìŒ (DB ìœ ì¶œ ì‹œ ìœ„í—˜)
```

#### âš ï¸ ë³´ì•ˆ ê²½ê³ 

```
1. DB ìœ ì¶œ ì‹œ ëª¨ë“  ì‚¬ìš©ì ê³„ì • ë…¸ì¶œ
2. GDPR/ê°œì¸ì •ë³´ ê·œì • ìœ„ë°˜
3. ê°ì‹œ ê¸°ê´€ ê·œì • ë¯¸ì¤€ìˆ˜
```

#### âœ… í•´ê²°ì±… (ì„œë²„ ì½”ë“œ)

```javascript
// Node.js - bcrypt ì‚¬ìš©
const bcrypt = require("bcrypt");

// íšŒì›ê°€ì…
const hashedPassword = await bcrypt.hash(password, 10);

// ë¡œê·¸ì¸
const isValid = await bcrypt.compare(password, user.password);
```

---

### 8ï¸âƒ£ ì¸ë±ìŠ¤ ìµœì í™” (ì‹¬ê°ë„: ì¤‘ê°„)

#### âŒ í˜„ì¬ ìƒíƒœ - ë‹¨ì¼ ì»¬ëŸ¼ ì¸ë±ìŠ¤ë§Œ ìˆìŒ

```sql
CREATE INDEX idx_like_userid ON "public"."like" ("userid");
CREATE INDEX idx_like_contentid ON "public"."like" ("contentid");
-- ë¶„ë¦¬ë˜ì–´ ìˆìŒ â†’ ì¿¼ë¦¬ ì„±ëŠ¥ ì €í•˜
```

#### ğŸ› ì„±ëŠ¥ ë¬¸ì œ

```sql
-- ì´ ì¿¼ë¦¬ëŠ” INDEXê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŒ
SELECT * FROM "like"
WHERE user_id = ? AND content_id = ?;
```

#### âœ… ê°œì„ ì•ˆ - ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€

```sql
-- Like í…Œì´ë¸” ë³µí•© ì¸ë±ìŠ¤
CREATE INDEX idx_like_user_content
    ON "public"."like" ("user_id", "content_id");

-- Follow í…Œì´ë¸” ë³µí•© ì¸ë±ìŠ¤
CREATE INDEX idx_follow_follower_followee
    ON "public"."follow" ("follower_id", "followee_id");

-- Content ì •ë ¬/í•„í„°ë§ìš© ì¸ë±ìŠ¤
CREATE INDEX idx_content_created_at
    ON "public"."content" ("created_at" DESC);

CREATE INDEX idx_content_user_id_public
    ON "public"."content" ("user_id", "is_public");

-- ê²€ìƒ‰ìš© ì¸ë±ìŠ¤
CREATE INDEX idx_content_title_text
    ON "public"."content" USING GIN(to_tsvector('korean', "title"));
```

---

### 9ï¸âƒ£ ê¸°ëŠ¥ ëˆ„ë½ (ì‹¬ê°ë„: ë‚®ìŒ ~ ì¤‘ê°„)

#### âŒ í˜„ì¬ ìŠ¤í‚¤ë§ˆì— ì—†ëŠ” í…Œì´ë¸”

**1. ëŒ“ê¸€ (Comment)**

```sql
CREATE TABLE "public"."comment" (
    "id" bigint generated by default as identity PRIMARY KEY,
    "content_id" bigint NOT NULL,
    "user_id" character varying(255) NOT NULL,
    "text" text NOT NULL,
    "created_at" timestamp DEFAULT now(),
    "updated_at" timestamp DEFAULT now(),
    constraint "comment_content_fkey"
        foreign key ("content_id") references "content"("id") on delete cascade,
    constraint "comment_user_fkey"
        foreign key ("user_id") references "user"("id") on delete cascade
);
```

**2. ì €ì¥/ë¶ë§ˆí¬ (Bookmark)**

```sql
CREATE TABLE "public"."bookmark" (
    "id" bigint generated by default as identity PRIMARY KEY,
    "user_id" character varying(255) NOT NULL,
    "content_id" bigint NOT NULL,
    "created_at" timestamp DEFAULT now(),
    constraint "unique_bookmark" unique ("user_id", "content_id"),
    foreign key ("user_id") references "user"("id") on delete cascade,
    foreign key ("content_id") references "content"("id") on delete cascade
);
```

**3. ì‹ ê³  (Report)**

```sql
CREATE TABLE "public"."report" (
    "id" bigint generated by default as identity PRIMARY KEY,
    "reporter_id" character varying(255) NOT NULL,
    "content_id" bigint,
    "reason" character varying(100) NOT NULL,
    "description" text,
    "status" character varying(20) DEFAULT 'pending',
    "created_at" timestamp DEFAULT now(),
    constraint "report_reporter_fkey"
        foreign key ("reporter_id") references "user"("id") on delete cascade,
    constraint "report_content_fkey"
        foreign key ("content_id") references "content"("id") on delete cascade
);
```

---

## ğŸ“Š ê°œì„  ìš°ì„ ìˆœìœ„

| ìš°ì„ ìˆœìœ„    | í•­ëª©                       | ì˜í–¥ë„  |
| ----------- | -------------------------- | ------- |
| 1ï¸âƒ£ **ì¦‰ì‹œ** | Like UNIQUE ì œì•½ ì¶”ê°€      | ğŸ”´ ë†’ìŒ |
| 1ï¸âƒ£ **ì¦‰ì‹œ** | Follow ìê¸° íŒ”ë¡œìš° ë°©ì§€    | ğŸ”´ ë†’ìŒ |
| 1ï¸âƒ£ **ì¦‰ì‹œ** | ë³€ìˆ˜ëª… ì¼ê´€ì„± (snake_case) | ğŸ”´ ë†’ìŒ |
| 2ï¸âƒ£ **ë†’ìŒ** | íŒ¨ìŠ¤ì›Œë“œ í•´ì‹œí™” (ì½”ë“œ)     | ğŸ”´ ë†’ìŒ |
| 2ï¸âƒ£ **ë†’ìŒ** | User í…Œì´ë¸” í•„ë“œ ì¶”ê°€      | ğŸŸ  ì¤‘ê°„ |
| 2ï¸âƒ£ **ë†’ìŒ** | Content ë©”íƒ€ë°ì´í„° ì¶”ê°€    | ğŸŸ  ì¤‘ê°„ |
| 3ï¸âƒ£ **ì¤‘ê°„** | ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€           | ğŸŸ  ì¤‘ê°„ |
| 3ï¸âƒ£ **ì¤‘ê°„** | Tag í…Œì´ë¸” ì •ê·œí™”          | ğŸŸ  ì¤‘ê°„ |
| 4ï¸âƒ£ **ì„ íƒ** | ëŒ“ê¸€/ë¶ë§ˆí¬ í…Œì´ë¸”         | ğŸŸ¡ ë‚®ìŒ |

---

## âœ… ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì •ê·œí™” (Normalization)

- [ ] ì¤‘ë³µ ë°ì´í„° ì œê±° (Tag ì •ê·œí™”)
- [ ] ì ì ˆí•œ Foreign Key ì„¤ì •
- [ ] Primary Key ëª…í™• ì •ì˜

### ë°ì´í„° ë¬´ê²°ì„±

- [ ] UNIQUE ì œì•½ ì¶”ê°€ (Like, Follow)
- [ ] CHECK ì œì•½ ì¶”ê°€ (Follow ìê¸° íŒ”ë¡œìš°)
- [ ] NOT NULL ì œì•½ ëª…í™•í™”

### ì„±ëŠ¥

- [ ] ì¸ë±ìŠ¤ ì„¤ì • ê²€í† 
- [ ] ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€
- [ ] ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš ë¶„ì„ í•„ìš”

### ë³´ì•ˆ

- [ ] íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™”
- [ ] Row Level Security ì •ì±…
- [ ] API í‚¤ ê´€ë¦¬

### í™•ì¥ì„±

- [ ] ì¶”í›„ ê¸°ëŠ¥ í™•ì¥ ê³ ë ¤ (ëŒ“ê¸€, ì‹ ê³  ë“±)
- [ ] ì•„ì¹´ì´ë¹™/ì‚­ì œ ì „ëµ ê²€í† 
- [ ] ê°ì‹œ/ë¡œê¹… ë°ì´í„° í•„ìš”ì„± ê²€í† 

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. **SQL ìŠ¤í‚¤ë§ˆ ìˆ˜ì •** - ê°œì„ ëœ ë²„ì „ìœ¼ë¡œ êµì²´
2. **ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸** - ê¸°ì¡´ ë°ì´í„° ë³€í™˜
3. **ORM ëª¨ë¸ ìˆ˜ì •** - TypeScript/Prisma ëª¨ë¸ ì—…ë°ì´íŠ¸
4. **í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤** - ë°ì´í„° ë¬´ê²°ì„± í…ŒìŠ¤íŠ¸

ì›í•˜ì‹œë©´ **ê°œì„ ëœ ì™„ì „í•œ SQL_SCHEMA.sql íŒŒì¼**ì„ ìƒì„±í•´ë“œë¦´ê¹Œìš”? ğŸš€
